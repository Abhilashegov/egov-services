---
ReportDefinitions:
# Employee Search Report
- reportName: Employee Search
  summary: Employee Search
  version: 1.0.0
  sourceColumns:
  - name: code
    label: reports.hr.employee.Employee_Code         
    type: string
    source: egeis_employee
  - name: name
    label: reports.hr.employee.Employee_Name
    type: String
    source: eg_user
  - name: designation
    label: reports.hr.employee.Designation
    type: String
    source: egeis_assignment
  - name: department
    label: reports.hr.employee.Department
    type: String
    source: egeis_assignment
  searchParams:
  - name: departmentid
    label: reports.hr.Department
    type: singlevaluelist
    pattern: http://egov-common-masters:8080/egov-common-masters/departments/_search?tenantId=$tenantid|$..id|$..name
    source: eg_department
    isMandatory: false
    searchClause: and assign.departmentid=$departmentid
  - name: designationid
    label: reports.hr.Designation
    type: singlevaluelist
    pattern: http://hr-master:8080/hr-master/designations/_search?tenantId=$tenantid|$..id|$..name 
    source: egeis_designation
    isMandatory: false
    searchClause: and assign.designationid=$designationid
  - name: code
    label: reports.hr.Employee_Code/Name 
    type: String
    source: hr 
    isMandatory: false
    searchClause: and emp.code=$code
  - name: employeeType
    label: reports.hr.Employee_Type
    type: singlevaluelist
    pattern: http://hr-master:8080/hr-master/employeetypes/_search?tenantId=$tenantid|$..id|$..name
    source: egeis_employeetype  
    isMandatory: false
    searchClause: and emp.employeetypeid=$employeeType
  - name: status
    label: reports.hr.Status
    type: singlevaluelist
    pattern: http://hr-master:8080/hr-master/hrstatuses/_search?tenantId=$tenantid|$..id|$..name
    source: egeis_hrstatus
    searchClause: and emp.employeestatus=$status
  - name: reports
    label: reports.hr.viewreport
  query: select  emp.code as code ,usr.name as name,dept.name as department,desig.name as designation 
    from egeis_employee emp, egeis_assignment assign,eg_user usr, eg_department dept,egeis_designation desig
    where  
    usr.type='EMPLOYEE'
    and assign.employeeid=emp.id
    and usr.id=emp.id
    and assign.departmentid=dept.id
    and assign.designationid=desig.id
    order by usr.name
    
   #attendance Report 
- reportName: Attendence Report
  summary: Attendence Report
  version: 1.0.0
  sourceColumns:
  - name: employeecode
    label: reports.hr.Attendence.Employee_Code_name         
    type: string
    source: egeis_employee
    
  - name: presentDays
    label: reports.hr.Attendence.presentDays
    type: String
    source: egeis_assignment
    
  - name: absentDays
    label: reports.hr.Attendence.absentDays
    type: String
    source: egeis_assignment
    
  - name: leaveDays
    label: reports.hr.Attendence.leaveDays
    type: String
    source: egeis_assignment
    
  - name: noOfOTs
    label: reports.hr.Attendence.noOfOTs
    type: String
    source: egeis_assignment
    
  searchParams:
  - name: month
    label: reports.hr.month
    type: singlevaluelist
    pattern: 'list://1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11,12:12'
    source: hr
    isMandatory: true
  
  - name: Year
    label: reports.hr.calenderYear
    type: singlevaluelist
    pattern: http://egov-common-masters:8080/egov-common-masters/calendaryears/_search?tenantId=$tenantId|$..name
    source: eg_calendarYear
    isMandatory: true
    
  - name: departmentId
    label: reports.hr.Department
    type: singlevaluelist
    pattern: http://egov-common-masters:8080/egov-common-masters/departments/_search?tenantId=$tenantId|$..name
    source: hr
    isMandatory: false
    searchClause: and dept.id=$departmentId
    
  - name: designation
    label: reports.hr.Designation
    type: singlevaluelist
    pattern: http://hr-master:8080/hr-master/designations/_search?tenantId=$tenantId|$..name  
    source: hr
    isMandatory: false
    searchClause: and desig.id=$designation
    
  - name: code
    label: reports.hr.Employee_Code/Name 
    type: String
    source: egeis_employee 
    isMandatory: false
    searchClause: and emp.code=$code
    
  - name: employeeType
    label: reports.hr.Employee_Type
    type: singlevaluelist
    pattern: http://hr-master:8080/hr-master/employeetypes/_search?tenantId=$tenantId|$..name
    source: egeis_employee  
    isMandatory: false
    searchClause: and emp.type=$employeeType
    
  query: select emp.code||'-'||usr.name as employeecodename ,
    sum(case when att.type=(select id from egeis_attendance_type where code='P') and month=$month and year= $Year then 1 else 0 end) presentDays,
    sum(case when att.type=(select id from egeis_attendance_type where code='A') and month=$month and year= $Year then 1 else 0 end) absentDays,
    sum(case when att.type=(select id from egeis_attendance_type where code='L') and month=$month and year= $Year then 1 else 0 end) leavesDays,
    sum(case when att.type=(select id from egeis_attendance_type where code='H') and month=$month and year= $Year then 1 else 0 end) holidays
    from egeis_employee emp,eg_user usr,egeis_attendance att,
    egeis_assignment assign,eg_department dept,egeis_designation desig,egeis_attendance_type attyp
    where assign.employeeid=emp.id
    and att.employee=emp.id
    and attyp.id=att.type
    and assign.designationid = desig.id
    and assign.departmentid = dept.id
    and usr.id=emp.id
    and att.tenantid=attyp.tenantid
  groupBy: ORDER BY usr.name,emp.code;
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    
    

  
  
  
