swagger: '2.0'
# eGSP YAML Template Version: 1.0 
# This is a version number for the YAML template. This must not be changed.

info:
  version: 1.0.0
  ######################################################
  # All API's are POST. _create,_search,_update for post,get and put. RequestInfo will be part of body. For multiple records we can pass multiple value with comman seperated values*.
  # All _search will be synchronous and all _create and _update will be asynchronous*.
  # RequestInfo and ResponseInfo object should be reffered from Common*.
  # In _search API, tenantId should be passed in query param. In _create/_update, tenantId should be passed in the model.
  # Readonly means that even if these fields are passed in the request, it will be ignored in create/update and will not be added/updated in the entities. The readonly fields might be passed to the _search API's to make use of fields for the search Query API. while calling _search API's even mandatory fields might not be available, it is mandatory only in the _create API's*.
  # All errors will be returned with HTTP error code 400 with customized error code and messages. Consumer of the API need to handle 400 with customized error code and message.
  # Definition must start with Upper case followed by camel case.
  # Every model will have tenantId. Validate tenantId on create.
  # Parameter name must start with small case followed by camel case.
  # Path must be in small case.
  ######################################################
  
  title: eGov Property Tax Information System.
  description: |
    APIs for Property Tax module. This modules handles assessment of new properties, changes to existing properties (Detail Updates, division of property, amalgmation of properties, title transfer etc.), search of required properties and property tax calculation, demand generation, notices to enable ULBs to cmpletely manage the proeprties within their jurisdiction.
  contact:
    name: Ramki
host: phoenix-qa.egovernments.org
schemes:
  - https
basePath: '/properties/v1'
x-common-path: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml'

paths:
  /_search:
    post:
      summary: Get the list of properties defined in the system.
      description: |
        Get the properties list based on the input parameters.
      # This is array of GET operation parameters:
      parameters:
        - $ref: "https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/parameters/requestInfo"
        - $ref: "https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/parameters/tenantId"
        - $ref: "#/parameters/pageSize"
        - $ref: "#/parameters/pageNumber"
        - $ref: "#/parameters/sortProperty"
        - name: active
          in: query
          description: True will be set in cases where only active properties are needed and False will be set when inactive properties are needed and no value will be set when all properties are needed.
          required: false
          type: boolean
          format: varchar
          allowEmptyValue: true
        - name: upicNo
          in: query
          required: false
          description: The unique reference number for a property.
          type: string
          minLength: 4
          maxLength: 128
          exclusiveMinimum: true
          exclusiveMaximum: false
        - name: oldUpicNo
          in: query
          required: false
          description: The unique old upic no for a Property.
          type: string
          minLength: 4
          maxLength: 128
          exclusiveMinimum: true
          exclusiveMaximum: false
        - name: mobileNumber
          in: query
          required: false
          description: The mobile number of a Property owner.
          type: string
          pattern: "[0-9]"
          maxLength: 10
          exclusiveMaximum: true
        - name: aadhaarNumber
          in: query
          required: false
          description: The Aadhaar number of a Property owner.
          type: string
          pattern: "[0-9]"
          maxLength: 12
          exclusiveMaximum: true
        - name: houseNoBldgApt
          in: query
          required: false
          description: The house no for a building of a property.
          type: string
          minLength: 0
          maxLength: 32
          exclusiveMinimum: true
          exclusiveMaximum: false
        - name: revenueZone
          in: query
          description: Revenue Zone boundary where the property is located.
          required: false
          type: integer
          format: int64
        - name: revenueWard
          in: query
          description: Revenue Ward boundary where the property is located.
          required: false
          type: integer
          format: int64
        - name: locality
          in: query
          description: Locality boundary where the property is located.
          required: false
          type: integer
          format: int64
        - name: ownerName
          in: query
          required: false
          description: The name of a Property owner.
          type: string
          minLength: 4
          maxLength: 100
          exclusiveMinimum: true
          exclusiveMaximum: false
        - name: demandFrom
          in: query
          description: Property tax from amount. Properties can be searched between the tax amounts. This is the from amount.
          required: false
          type: integer
          format: int64
        - name: demandTo
          in: query
          description: Property tax to amount. Properties can be searched between the tax amounts. This is the to amount.
          required: false
          type: integer
          format: int64
      responses:
        200:
          description: Successful response
          schema:
            $ref: "#/definitions/PropertyResponse"
        '400':
          description: Invalid input.
          schema:
            $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/ErrorRes'
      tags:
       - Property
       
  /_create:
  ######################################################
  # Will be asynchronous.
  # tenantId should be passed in the model.
  # Validate tenantId before persisting.
  ######################################################
    post:
      summary: Create new properties.
      description: API to create new properties.
      parameters:
        - name: property
          in: body
          description: Details for the new property + RequestInfo meta data.
          required: true
          schema:
            $ref: '#/definitions/PropertyRequest'
      
      responses:
      ####################################################
      # All errors will be returned with HTTP error code 400 with customized error code and messages. Consumer of the API need to handle 400 with customized error code and message
      ###################################################
        201:
          description: Property(s) created sucessfully
          schema:
            $ref: '#/definitions/PropertyResponse'
        400:
          description: Property(s) creation failed
          schema:
            $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/ErrorRes'
      tags:
        - Property  
        
  /properties/_update:
    post:
      description: Updates a given `Property` with newer details.
      parameters:
        - name: property
          in: body
          description: Request header for the property Request.
          required: true
          schema:
            $ref: '#/definitions/PropertyRequest'
      tags:
        - Property
      responses:
        '200':
          description: Update Property(s) successful
          schema:
            $ref: '#/definitions/PropertyResponse'
        '400':
          description: Update Property(s) failed
          schema:
            $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/ErrorRes'
  
definitions:
########################################################
#RequestInfo and ResponseInfo object should be reffered from Common.
#Definition must start with Upper case followed by camel case.
#Every model will have tenantId
########################################################
    
  Property:
    type: object
    description: A Object holds the basic data for a property
    properties:
      id:
        type: integer
        format: int64
        description: Unique Identifier of the Property
      tenantId:
        type: string
        description: tenant id of the Property
        maxLength: 128
        minLength: 4
      upicNo:
        type: string
        description: UPIC (Unique Property Identification Code) of the Property. This is a unique in system
        maxLength: 128
        minLength: 6
      oldUpicNo:
        type: string
        description: Old upic no of the Property. ULBs have the existing property in their system/manual records with their identification number, they want to continue the old reference number in this case the same identification number will be captured here.
        maxLength: 128
        minLength: 4
      vltUpicNo:
        type: string
        description: Vacant lands also be assessed in system. If building constructed in the same vacant land. The Vacant land upicno will be captured here for a the new building.
        maxLength: 128
        minLength: 4
      creationReason:
        type: string
        description: New property comes into system either property is newly constructed or existing property got sub divided. Here the reason for creation will be captured.
        maxLength: 256
        minLength: 1
        enum:
         - NEWPROPERTY
         - SUBDIVISION
      address:
        $ref: "https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/Address"
      owners:
        description: Property owners, these will be citizen users in system.
        type: array
        items:
          $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/egov-user/contracts/v1-1-0.yml#/definitions/User'
      propertyDetail:
        $ref: "#/definitions/PropertyDetail"
      assessmentDate:
        type: string
        format: date
        description: There will be work flow to create a new property in a system. The assessment date is the final approval and UPIC no generation date.
      occupancyDate:
        type: string
        format: date
        description: Property is constructed but the tax will be applicable only from the occupation date. System capture that date here.
      gisRefNo:
        type: string
        description: Property tax system will be integrated with GIS system. Here we capture the GIS ref. no.
        maxLength: 32
        minLength: 4
      isAuthorised:
        type: boolean
        description: Property can be authorised or not authorised in a ULB depends on different parameters Eg. If there is Building plan approval property is a authorised property otherwise its a not a authorised property. System will capture the info here.
        default: true
      isUnderWorkflow:
        type: boolean
        description: There are different transactions can be performed on a property and all the transactions goes through the work flow. If one workflow is happening system should not allow other work flow on a same property so, when any work flow starts we flag this field as true and when the same work flow ends we flag this field as false.
        default: false
      boundary:
        $ref: "#/definitions/PropertyBoundary"
      active:
        type: boolean
        description: True if the property is active and False if the property is inactive.
        default: true
      channel:
        type: string
        description: Property can be created from different channels Eg. System (properties created by ULB officials), CFC Counter (From citizen faciliation counters) etc. Here we are defining some known channels, there can be more client to client.
        maxLength: 16
        minLength: 4
        enum:
         - SYSTEM
         - CFC_COUNTER
         - CITIZEN
      auditDetails:
        $ref: "https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/AuditDetails"
    required:
    - tenantId
    - upicNo
    - creationReason
    - address
    - owners
    - boundary
    - propertyDetail
    - occupancyDate
    - channel
    
  PropertyRequest:
    description: Contract class to receive request. Array of Property items  are used in case of create . Where as single Property item is used for update
    properties:
      requestInfo:
        $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/RequestInfo'
      properties:
        description: Used for search result and create only
        type:  array
        minimum: 1
        maximum: 100
        items:
          $ref: '#/definitions/Property'
          
  PropertyResponse:
    description: Contract class to send response. Array of Property items  are used in case of search results or response for create. Where as single Property item is used for update
    properties:
      responseInfo:
        $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/ResponseInfo'
      properties:
        description: Used for search result and create only
        type:  array
        items:
          $ref: '#/definitions/Property'

  PropertyDetail:
    type: object
    properties:
      id:
        type: integer
        format: int64
        description: Unique Identifier of the PropertyDetail
      tenantId:
        type: string
        description: tenant id of the PropertyDetail
        maxLength: 128
        minLength: 4
      source:
        type: string
        description: Source of a assessment data. The properties will be created in a system based on the data avaialble in their manual records or during field survey. There can be more from client to client.
        maxLength: 64
        minLength: 1
        enum:
         - MUNICIPAL_RECORDS
         - FIELD_SURVEY
      regdDocNo:
        type: string
        description: Property registered no from Registration Department.
        maxLength: 64
        minLength: 1
      regdDocDate:
        type: string
        format: date
        description: roperty registered date from Registration Department.
      reason:
        type: string
        description: reason of the PropertyDetail
        maxLength: 16
        minLength: 1
      status:
        type: string
        description: status of the Property
        maxLength: 8
        minLength: 1
        enum:
         - ACTIVE
         - INACTIVE
         - WORKFLOW
         - HISTORY
         - CANCELED
      isVerified:
        type: boolean
        description: When 'source' of property is FIELD_SURVEY then property should be verified by higher officials or during a work flow also property to be verified in some cases. This field to capture the verification status.
      verificationDate:
        type: string
        format: date
        description: verification date of the Property
      isExempted:
        type: boolean
        description: Property can be exempted from tax for different reasons, this field captures the exempted status
        default: false
      exemptionReason:
        type: string
        description: exemption reason for the property
        maxLength: 32
        minLength: 1
      propertyType:
        type: string
        description: Type of a property like Private, Vacant Land, State Government, Central Government etc.
        maxLength: 16
        minLength: 1
      category:
        type: string
        description: category of the property like Residential, Non-Residential, etc.
        maxLength: 16
        minLength: 1
      usage:
        type: string
        description: usage of the property
        maxLength: 16
        minLength: 1
      department:
        type: string
        description: department of the property which belongs to. This is applicable when property type is State Govternment or Central Government.
        maxLength: 16
        minLength: 1
      apartment:
        type: string
        description: apartment of the PropertyDetail
        maxLength: 16
        minLength: 1
      siteLength:
        type: number
        format: double
        description: length of the land
      siteBreadth:
        type: number
        format: double
        description: breadth of the land
      sitalArea:
        type: number
        format: double
        description: sital area of the land
      totalBuiltupArea:
        type: number
        format: double
        description: total builtup area of the property. If building has multiple floors, this is a sum of individual floor builtup area.
      undividedShare:
        type: number
        format: double
        description: undivided share of the flat. In case of apartment this is valid.
      noOfFloors:
        type: integer
        format: int64
        description: no of floors in the property
      isSuperStructure:
        type: boolean
        description: is property a super structure. If Land is ownned by one person and building constructed by one person then its called Super structure
        default: false
      landOwner:
        type: string
        description: Name of the land owner in case property is Super structure
        maxLength: 128
        minLength: 1
      floorType:
        type: string
        description: type of floor
        maxLength: 16
        minLength: 1
      woodType:
        type: string
        description: type of wood used in the property
        maxLength: 16
        minLength: 1
      roofType:
        type: string
        description: type of roof the property having
        maxLength: 16
        minLength: 1
      wallType:
        type: string
        description: type of walls the property having
        maxLength: 16
        minLength: 1
      vacantLand:
        $ref: "#/definitions/VacantLandProperty"
      floors:
        description: Floors
        type: array
        items:
          $ref: '#/definitions/Floor'
      documents:
        description: The documents attached during assessment, modification or any transaction happened on the property.
        type: array
        items:
          $ref: '#/definitions/Document'
      stateId:
        type: string
        description: Work flow ref id.
      channel:
        type: string
        description: Property can be created or modified from different channels Eg. System (properties created by ULB officials), CFC Counter (From citizen faciliation counters) etc. Here we are defining some known channels, there can be more client to client.
        maxLength: 16
        minLength: 4
        enum:
         - SYSTEM
         - CFC_COUNTER
         - CITIZEN
      applicationNo:
        type: string
        description: Acknowldgement number given to citizen on submitting the application for creation or modification of the property.
        maxLength: 64
        minLength: 1
      workFlowDetails:
        $ref: '#/definitions/WorkFlowDetails'
      auditDetails:
        $ref: "https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/AuditDetails"
    required:
    - tenantId
    - channel
    - sitalArea
    - propertyType

  PropertyBoundary:
    type: object
    properties:
      id:
        type: integer
        format: int64
        description: Unique Identifier of the PropertyBoundary
      tenantId:
        type: string
        description: tenant id of the PropertyBoundary
        maxLength: 128
        minLength: 4
      longitude:
        type: number
        format: double
        description: longitude of the Property
      latitude:
        type: number
        format: double
        description: latitude of the Property
      revenueZone:
        $ref: '#/definitions/Boundary'
      revenueWard:
        $ref: '#/definitions/Boundary'
      revenueBlock:
        $ref: '#/definitions/Boundary'
      area:
        $ref: '#/definitions/Boundary'
      locality:
        $ref: '#/definitions/Boundary'
      street:
        $ref: '#/definitions/Boundary'
      adminWard:
        $ref: '#/definitions/Boundary'
      northBoundedBy:
        type: string
        description: property bounded by on north side
        maxLength: 256
        minLength: 1
      eastBoundedBy:
        type: string
        description: property bounded by on east side
        maxLength: 256
        minLength: 1
      westBoundedBy:
        type: string
        description: property bounded by on west side
        maxLength: 256
        minLength: 1
      southBoundedBy:
        type: string
        description: property bounded by on south side
        maxLength: 256
        minLength: 1
      auditDetails:
        $ref: "https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/AuditDetails"
    required:
    - tenantId

  VacantLandProperty:
    allOf: 
    - $ref: '#/definitions/Property'
    - type: object
      properties:
        surveyNumber:
          type: string
          description: survey number of the Land
          maxLength: 64
          minLength: 4
        pattaNumber:
          type: string
          description: patta number of the Land
          maxLength: 64
          minLength: 4
        marketValue:
          type: number
          format: double
          description: market value of the Land
        capitalValue:
          type: number
          format: double
          description: capital value of the Land
        layoutApprovedAuth:
          type: string
          description: layout approved authority of the Land
          maxLength: 64
          minLength: 4
        layoutPermissionNo:
          type: string
          description: layout permission no by approved authority for the Land
          maxLength: 64
          minLength: 4
        layoutPermissionDate:
          type: string
          format: date
          description: layout permission date by approved authority for the Land
        resdPlotArea:
          type: number
          format: double
          description: resd plot area of the land
        nonResdPlotArea:
          type: number
          format: double
          description: non resd plot area of the land
        
  Floor:
    type: object
    description: The floor details
    properties:
      id:
        type: integer
        format: int64
        description: Unique Identifier of the Floor
      tenantId:
        type: string
        description: tenant id of the floor
        maxLength: 128
        minLength: 4
      floorNo:
        type: string
        description: floor no for the floor
        maxLength: 16
        minLength: 1
      unitNo:
        type: string
        description: unit no in a floor. Some ULBs captures the room wise details in case in the same floor different rooms are used for different purposes.
        maxLength: 8
        minLength: 1
      unitType:
        type: string
        description: type of the unit in a floor
        maxLength: 16
        minLength: 1
      length:
        type: number
        format: double
        description: length of the Floor
      width:
        type: number
        format: double
        description: width of the Floor
      builtupArea:
        type: number
        format: double
        description: builtup area of the Floor
      assessableArea:
        type: number
        format: double
        description: assessable area for the Floor. Some ULBs have their own logic to consider builtup area for tax calculation.
      bpaBuiltupArea:
        type: number
        format: double
        description: builtup area given during the Building plan approval of the Floor
      usage:
        type: string
        description: usage of the Floor
        maxLength: 16
        minLength: 1
      occupancy:
        type: string
        description: occupancy of the Floor
        maxLength: 16
        minLength: 1
      structure:
        type: string
        description: structure of the Floor
        maxLength: 16
        minLength: 1
      age:
        type: string
        description: age of the Floor
        maxLength: 16
        minLength: 1
      occupierName:
        type: string
        description: Name of the occupier in a Floor
        maxLength: 128
        minLength: 1
      firmName:
        type: string
        description: Name of the firm in a Floor
        maxLength: 128
        minLength: 1
      rentCollected:
        type: number
        format: double
        description: rent collected for the Floor it its given tenants are living.
      exemptionReason:
        type: string
        description: exemption reason for the Floor
        maxLength: 32
        minLength: 1
      isStructured:
        type: boolean
        description: is floor is structured. Some building may not be in square or rectangle or in a proper shape to calculate a builtup area.
        default: true
      occupancyDate:
        type: string
        format: date
        description: occupancy date of the Floor
      constCompletionDate:
        type: string
        format: date
        description: construction completion date of the Floor
      bpaNo:
        type: string
        description: Buidling plan approval no for the Floor
        maxLength: 16
        minLength: 1
      bpaDate:
        type: string
        format: date
        description: Buidling plan approval date for the Floor
      manualArv:
        type: number
        format: double
        description: manual arv for the Floor
      arv:
        type: number
        format: double
        description: The system calculated arv for the Floor
      electricMeterNo:
        type: string
        description: electricity meter no for the Floor
        maxLength: 64
        minLength: 1
      waterMeterNo:
        type: string
        description: water meter no for the Floor
        maxLength: 64
        minLength: 1
      auditDetails:
        $ref: "https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/AuditDetails"
    required:
    - id
    - tenantId
    - floorNo
    - builtupArea
    - usage
    - occupancy
    - structure

  WorkFlowDetails:
    type: object
    description: This object holds info about the assignee and other workflow related info
    properties:
      department:
        type: string
        description: Selected department.
      designation:
        type: string
        description: Selected designation.
      assignee:
        type: integer
        format: int64
        description: Selected assignee.
      action:
        type: string
        description: chosen action.
      status:
        type: string
        description: current status.

  DocumentType:
    type: object
    description: This object holds type of documents to be uploaded during the transaction for each application type.
    properties:
      id:
        type: integer
        format: int64
        description: unique id of the ApplicationType.
      name:
        type: string
        description: name of the document
      application:
        type: string
        description: Application type.
        enum:
          - CREATE
          - RENEWAL
          - EVICTION
          - CANCEL
          
  Document:
    type: object
    description: This object holds list of documents attached during the transaciton for a agreement
    properties:
      id:
        type: integer
        format: int64
        description: unique id of the ApplicationType.
      documentType:
        $ref: '#/definitions/DocumentType'
      fileStore:
        type: string
        description: File store reference key.

  Boundary:
    type: object
    description: This object the boundary info
    properties:
      id:
        type: integer
        format: int64
        description: unique id of the Boundary.
      name:
        type: string
        description: Name of the boundary.
      
parameters:
##########################################################
#Parameter name must start with small case followed by camel case.
##########################################################
  pageSize:
    name: pageSize
    in: query
    description: Number of records returned.
    type: integer
    minimum: 0
    exclusiveMinimum: true
    maximum: 100
    exclusiveMaximum: false
    multipleOf: 10
    default: 20
  pageNumber:
    name: pageNumber
    in: query
    description: Page number
    type: integer
    default: 1
  sortProperty:
    name: sort
    in: query
    description: Property results will be sorted by upicno ascending by default if this parameter is not provided.
    type: array
    uniqueItems: true
    minItems: 1
    maxItems: 3
    collectionFormat: pipes
    items:
      type: string
      pattern: '[-+](upicno|doorNumber|ownerName)'
    default:
      - +upicno

tags:
  - name: Property
    description: APIs required for property.
