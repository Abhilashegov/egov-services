server {
    listen 80;
    resolver 127.0.0.1:53 ipv6=off;
	root /var/pgr-web;
	underscores_in_headers on;
      set $pgr_rest_server http://pgr-rest;
      set $location_server http://egov-location;
      set $filestore_server http://egov-filestore;
      set $localization_server http://egov-localization;
      set $user_server http://egov-user;
      set $work_flow_server http://egov-workflow;
      set $egov_hr_masters http://egov-hr-masters;
      set $egov_common_masters http://egov-common-masters;
      set $eis_server http://egov-eis;
      set $kibana_es_cluster http://kibana.es-cluster;

	location /{

	}

	location /pgr {
		proxy_set_header        Host $host;
      	proxy_set_header        X-Real-IP $remote_addr;
      	proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
      	proxy_set_header        X-Forwarded-Proto $scheme;

        proxy_pass $pgr_rest_server:8080;
      	proxy_pass_request_headers on;
      	proxy_read_timeout  90;	
	}

	location ~ ^/(v1/location|a1/location)/ {
		proxy_set_header        Host $host;
      	proxy_set_header        X-Real-IP $remote_addr;
      	proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
      	proxy_set_header        X-Forwarded-Proto $scheme;

      	proxy_pass $location_server:8080;
      	proxy_pass_request_headers on;
      	proxy_read_timeout  90;	
	}

	location /filestore {
		proxy_set_header        Host $host;
      	proxy_set_header        X-Real-IP $remote_addr;
      	proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
      	proxy_set_header        X-Forwarded-Proto $scheme;
            
        # set client body size to 2M #
        client_max_body_size 30M;

      	proxy_pass $filestore_server:8080;
      	proxy_pass_request_headers on;
      	proxy_read_timeout  90;	
	}

    location /localization {
        proxy_set_header        Host $host;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        X-Forwarded-Proto $scheme;

        proxy_pass $localization_server:8080;
        proxy_pass_request_headers on;
        proxy_read_timeout  90;
    }

    location /user {
        proxy_set_header        Host $host;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        X-Forwarded-Proto $scheme;

        proxy_pass $user_server:8080;
        proxy_pass_request_headers on;
        proxy_read_timeout  90;
    }

    location /workflow {
        proxy_set_header        Host $host;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        X-Forwarded-Proto $scheme;

        proxy_pass $work_flow_server:8080;
        proxy_pass_request_headers on;
        proxy_read_timeout  90;
    }

    location /hr-masters {
        proxy_set_header        Host $host;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        X-Forwarded-Proto $scheme;

        proxy_pass $egov_hr_masters:8080;
        proxy_pass_request_headers on;
        proxy_read_timeout  90;
    }

    location /common-masters {
        proxy_set_header        Host $host;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        X-Forwarded-Proto $scheme;

        proxy_pass $egov_common_masters:8080;
        proxy_pass_request_headers on;
        proxy_read_timeout  90;
    }

    location /eis {
        proxy_set_header        Host $host;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        X-Forwarded-Proto $scheme;

        proxy_pass $eis_server:8080;
        proxy_pass_request_headers on;
        proxy_read_timeout  90;
    }

    location /dashboard {
        proxy_set_header        Host $host;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        X-Forwarded-Proto $scheme;

        proxy_pass $kibana_es_cluster:5601;
        proxy_pass_request_headers on;
        proxy_read_timeout  90;
    }
}